# =============================================================================
# Code Quality Tools Configuration
# =============================================================================
# This file configures multiple Python code quality tools:
# - flake8: Linting (PEP 8 style, common errors)
# - isort: Import sorting
# - mypy: Static type checking
#
# Why use setup.cfg instead of separate config files?
# - Single file for all tool configs (cleaner project root)
# - All tools support reading from setup.cfg
# - pyproject.toml is an alternative, but setup.cfg is more widely supported
# =============================================================================


# =============================================================================
# Flake8 Configuration
# =============================================================================
# Flake8 checks for PEP 8 compliance and common errors.
# Docs: https://flake8.pycqa.org/
#
# Run: flake8 .

[flake8]
# Maximum line length (matches black's default)
max-line-length = 88

# McCabe complexity threshold
# Functions with complexity > 10 are flagged
max-complexity = 10

# Directories to exclude from linting
exclude =
    migrations
    __pycache__
    venv
    .venv
    staticfiles

# Errors to ignore:
# E203: Whitespace before ':' (conflicts with black)
# E501: Line too long (we use max-line-length instead)
# W503: Line break before binary operator (conflicts with black)
extend-ignore = E203, E501, W503

# Show the source code for each error
show-source = True

# Count errors by type
statistics = True


# =============================================================================
# isort Configuration
# =============================================================================
# isort sorts Python imports into sections and alphabetically.
# Docs: https://pycqa.github.io/isort/
#
# Run: isort .
# Check only: isort --check-only .

[isort]
# Use black-compatible settings
profile = black

# Line length (matches black)
line_length = 88

# Directories to skip
skip =
    migrations
    venv
    .venv

# Skip files matching these glob patterns
skip_glob =
    **/migrations/*

# Import sections and their order
# FUTURE: __future__ imports
# STDLIB: Python standard library
# DJANGO: Django imports (custom section)
# DRF: Django REST Framework (custom section)
# THIRDPARTY: Other third-party packages
# FIRSTPARTY: Our project's packages
# LOCALFOLDER: Relative imports
sections =
    FUTURE
    STDLIB
    DJANGO
    DRF
    THIRDPARTY
    FIRSTPARTY
    LOCALFOLDER

# Packages to place in DJANGO section
known_django = django

# Packages to place in DRF section
known_drf = rest_framework

# Packages to place in FIRSTPARTY section
known_first_party =
    config
    products
    cart
    orders
    users

# Multi-line import style (matches black)
# Style 3: Each import on its own line, closing paren on separate line
multi_line_output = 3

# Include trailing comma in multi-line imports
include_trailing_comma = True

# Force imports to use parentheses for wrapping
force_grid_wrap = 0

# Use parentheses for line continuation
use_parentheses = True

# Ensure there's a single newline at end of file
ensure_newline_before_comments = True


# =============================================================================
# mypy Configuration
# =============================================================================
# mypy is a static type checker for Python.
# Docs: https://mypy.readthedocs.io/
#
# Run: mypy .

[mypy]
# Python version to target
python_version = 3.12

# Plugins for Django and DRF type stubs
plugins =
    mypy_django_plugin.main
    mypy_drf_plugin.main

# Warn about returning Any from functions
warn_return_any = True

# Warn about unused mypy config options
warn_unused_configs = True

# Warn about unused # type: ignore comments
warn_unused_ignores = True

# Warn about missing return statements
warn_no_return = True

# Disallow defining functions without type hints
disallow_untyped_defs = False

# Disallow calling functions without type hints
disallow_untyped_calls = False

# Ignore errors in third-party libraries without stubs
ignore_missing_imports = True

# Show error codes in output (helpful for ignoring specific errors)
show_error_codes = True

# Pretty print error messages
pretty = True

# Exclude paths from checking
exclude =
    migrations/
    venv/
    tests/


# Django-stubs plugin configuration
[mypy.plugins.django-stubs]
django_settings_module = config.settings


# =============================================================================
# Coverage Configuration
# =============================================================================
# pytest-cov uses coverage.py for test coverage reporting.
# Docs: https://pytest-cov.readthedocs.io/
#
# Run: pytest --cov=. --cov-report=html

[coverage:run]
# Measure branch coverage (if/else)
branch = True

# Source directories to measure
source = .

# Files/directories to exclude from coverage
omit =
    */migrations/*
    */tests/*
    */__pycache__/*
    venv/*
    .venv/*
    manage.py
    config/asgi.py
    config/wsgi.py

[coverage:report]
# Fail if coverage is below this threshold
fail_under = 85

# Don't show files with 100% coverage
skip_covered = True

# Show lines that weren't executed
show_missing = True

# Exclude these patterns from coverage reports
exclude_lines =
    # Don't complain about missing debug-only code
    def __repr__
    # Don't complain about abstract methods
    raise NotImplementedError
    # Don't complain about defensive assertions
    raise AssertionError
    # Don't complain about type checking blocks
    if TYPE_CHECKING:
    # Don't complain about ellipsis (protocol stubs)
    \.\.\.

[coverage:html]
# Output directory for HTML coverage report
directory = htmlcov
