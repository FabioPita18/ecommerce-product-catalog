# Nginx Configuration for React SPA
#
# Key configuration:
# 1. try_files: Falls back to index.html for client-side routing
#    (React Router handles the URL, not Nginx)
# 2. API proxy: Forwards /api requests to the Django backend container
# 3. Gzip: Compresses text-based assets for faster downloads
# 4. Static caching: Long cache for hashed assets (Vite adds content hashes)

server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Enable gzip compression for text-based assets
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # Handle SPA routing - all non-file URLs serve index.html
    # React Router then reads the URL and renders the correct page
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to the Django backend service
    # "backend" is the Docker Compose service name (resolved via Docker DNS)
    location /api {
        proxy_pass http://backend:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Cache static assets with content hashes for 1 year
    # Vite generates filenames like index-CFvylqeK.js with content hashes,
    # so the filename changes when the content changes (cache busting)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
